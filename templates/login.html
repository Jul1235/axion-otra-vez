
{% extends "base.html" %}

{% block title %}Axion Store - Iniciar Sesión{% endblock %}

{% block content %}
<div class="container">
    <div class="row justify-content-center align-items-center" style="min-height: 70vh;">
        <div class="col-md-5">
            <div class="card card-custom shadow-lg border-0">
                <div class="card-body p-5">
                    <div class="text-center mb-4">
                        <i class="fas fa-user-circle fa-4x" style="color: var(--primary);"></i>
                        <h2 class="mt-3 fw-bold">Iniciar Sesión</h2>
                        <p class="text-muted">Accede a tu cuenta de Axion Store</p>
                    </div>
                    
                    <form method="POST" action="{{ url_for('login') }}">
                        <div class="mb-3">
                            <label for="email" class="form-label">
                                <i class="fas fa-envelope"></i> Correo Electrónico
                            </label>
                            <input type="email" 
                                   class="form-control form-control-lg" 
                                   id="email" 
                                   name="email" 
                                   placeholder="tu@email.com" 
                                   required>
                        </div>
                        
                        <div class="mb-4">
                            <label for="password" class="form-label">
                                <i class="fas fa-lock"></i> Contraseña
                            </label>
                            <div class="password-wrapper">
                                <input type="password"
                                       class="form-control form-control-lg password-input"
                                       id="password"
                                       name="password"
                                       placeholder="••••••••"
                                       required>
                                <button type="button" class="password-toggle" aria-pressed="false" aria-label="Mostrar contraseña" title="Mostrar contraseña">
                                    <i class="fa fa-eye"></i>
                                </button>
                            </div>
                        </div>
                        
                        <div class="mb-3 form-check">
                            <input type="checkbox" class="form-check-input" id="remember">
                            <label class="form-check-label" for="remember">
                                Recordarme
                            </label>
                        </div>
                        
                        <button type="submit" class="btn btn-primary-custom btn-lg w-100 mb-3">
                            <i class="fas fa-sign-in-alt"></i> Entrar
                        </button>
                        
                        <div class="text-center">
                            <a href="#" class="text-decoration-none" id="forgot-password-link">¿Olvidaste tu contraseña?</a>
                        </div>
                    </form>
                    
                    <hr class="my-4">
                    
                    <div class="text-center">
                        <p class="mb-0">¿No tienes cuenta? 
                            <a href="{{ url_for('register') }}" class="fw-bold text-decoration-none" style="color: var(--primary);">
                                Regístrate aquí
                            </a>
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<div class="modal fade" id="forgotPasswordModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Restablecer contraseña</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
            </div>
            <div class="modal-body">
                <form id="reset-password-form">
                    <div class="mb-3">
                        <label for="reset-email" class="form-label">Correo electrónico</label>
                        <input type="email" id="reset-email" name="email" class="form-control" required>
                    </div>
                    <div class="mb-3">
                        <label for="reset-password" class="form-label">Nueva contraseña</label>
                        <input type="password" id="reset-password" name="new_password" class="form-control" required>
                    </div>
                    <div class="mb-3">
                        <label for="reset-confirm" class="form-label">Confirmar contraseña</label>
                        <input type="password" id="reset-confirm" name="confirm_password" class="form-control" required>
                    </div>
                </form>
                <div id="reset-feedback" class="mt-2" style="display:none;"></div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                <button type="button" id="reset-submit-btn" class="btn btn-primary">Restablecer</button>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const link = document.getElementById('forgot-password-link');
    const modalEl = document.getElementById('forgotPasswordModal');
    const bsModal = modalEl ? new bootstrap.Modal(modalEl) : null;
    const submitBtn = document.getElementById('reset-submit-btn');
    const feedback = document.getElementById('reset-feedback');

    if (link && bsModal) {
        link.addEventListener('click', function(e) { e.preventDefault(); bsModal.show(); });
    }

    async function showFeedback(text, type) {
        feedback.style.display = '';
        feedback.className = 'alert alert-' + (type || 'info');
        feedback.textContent = text;
    }

    if (submitBtn) {
        submitBtn.addEventListener('click', async function() {
            const form = document.getElementById('reset-password-form');
            const formData = new FormData(form);
            submitBtn.disabled = true;
            try {
                const resp = await fetch('/reset_password', { method: 'POST', body: formData, headers: { 'X-Requested-With': 'XMLHttpRequest' } });
                const json = await resp.json();
                if (resp.ok && json && json.status === 'ok') {
                    showFeedback(json.message || 'Contraseña actualizada. Inicia sesión con la nueva contraseña.', 'success');
                    setTimeout(() => { try { bsModal.hide(); } catch(e){} }, 1400);
                } else {
                    showFeedback((json && json.message) || 'Error al restablecer', 'danger');
                }
            } catch (e) {
                console.error(e);
                showFeedback('Error de red', 'danger');
            }
            submitBtn.disabled = false;
        });
    }
});
</script>

{% endblock %}